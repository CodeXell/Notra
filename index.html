<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Notra</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="Notra Icon-1024.png">
  
<style>
:root{
  --bg:#0a1020;
  --surface:#111a33;
  --surface-2:#0e1730;
  --accent:#4dc3ff;
  --text:#ffffff;
  --muted:rgba(255,255,255,.65);
  --border:rgba(255,255,255,.08);
  --highlight:#7f5fff;
  --sidebar-collapsed:70px;
  --sidebar-expanded:280px;
}

*{box-sizing:border-box}

html,body{
  margin:0;
  height:100%;
  font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
  background:
    radial-gradient(1200px 600px at 20% -10%, #15245a 0%, transparent 60%),
    radial-gradient(900px 500px at 90% 10%, #0f2a4f 0%, transparent 55%),
    var(--bg);
  color:var(--text);
  overflow:hidden;
}

.app-container{
  display:flex;
  height:100vh;
  flex-direction:column;
}

.main-layout{
  display:flex;
  flex:1;
  overflow:hidden;
}

.sidebar{
  width:var(--sidebar-collapsed);
  background:linear-gradient(180deg,#0e1833,#0b142b);
  border-right:1px solid var(--border);
  transition:width .3s cubic-bezier(0.4, 0.0, 0.2, 1);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  position:relative;
  z-index:100;
}

.sidebar:hover{
  width:var(--sidebar-expanded);
}

.sidebar-header{
  padding:20px;
  border-bottom:1px solid var(--border);
  white-space:nowrap;
}

.sidebar-header h1{
  font-size:15px;
  font-weight:700;
  color:var(--accent);
  margin:0;
  letter-spacing:.03em;
}

.sidebar-content{
  padding:20px;
  flex:1;
  overflow-y:auto;
  overflow-x:hidden;
}

.sidebar-title{
  font-size:11px;
  font-weight:700;
  color:var(--muted);
  letter-spacing:.12em;
  text-transform:uppercase;
  margin-bottom:14px;
  white-space:nowrap;
}

.sidebar-actions{
  display:flex;
  flex-direction:column;
  gap:10px;
}

.sidebar-action{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px;
  border-radius:10px;
  background:linear-gradient(135deg,rgba(77,195,255,.08),rgba(127,95,255,.08));
  border:1px solid var(--border);
  cursor:pointer;
  transition:all .3s ease;
  white-space:nowrap;
  min-height:48px;
}

.sidebar-action:hover{
  background:linear-gradient(135deg,rgba(77,195,255,.15),rgba(127,95,255,.15));
  border-color:rgba(77,195,255,.3);
  transform:translateX(5px);
  box-shadow:0 8px 24px rgba(77,195,255,.2);
}

.sidebar-action-icon{
  font-size:20px;
  min-width:20px;
  text-align:center;
}

.sidebar-action-content{
  flex:1;
  opacity:0;
  transition:opacity .3s ease .1s;
}

.sidebar:hover .sidebar-action-content{
  opacity:1;
}

.sidebar-action-title{
  font-weight:600;
  font-size:14px;
  margin-bottom:2px;
}

.sidebar-action-desc{
  font-size:12px;
  color:var(--muted);
}

.content-area{
  flex:1;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.workspace{
  flex:1;
  overflow-y:auto;
  padding:30px;
}

.content-header{
  padding:20px 30px;
  border-bottom:1px solid var(--border);
  background:linear-gradient(180deg,rgba(14,24,51,.6),rgba(11,20,43,.4));
  backdrop-filter:blur(10px);
}

.content-header h2{
  margin:0;
  font-size:24px;
  font-weight:700;
  background:linear-gradient(135deg,var(--accent),var(--highlight));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}

#backButton{
  display:none;
  margin:0 0 20px 0;
  padding:10px 20px;
  border-radius:999px;
  border:none;
  background:var(--accent);
  color:#06101f;
  font-weight:600;
  cursor:pointer;
  transition:transform .15s ease, box-shadow .15s ease;
}

#backButton:hover{
  transform:scale(1.08);
  box-shadow:0 0 18px rgba(77,195,255,.6);
}

.panel{
  background:linear-gradient(180deg,var(--surface),var(--surface-2));
  border-radius:16px;
  padding:24px;
  border:1px solid var(--border);
  box-shadow:0 20px 60px rgba(0,0,0,.55);
}

.notes-toolbar{
  display:flex;
  gap:12px;
  margin-bottom:20px;
  flex-wrap:wrap;
}

.notes-toolbar input{
  flex:1;
  min-width:250px;
  padding:12px 16px;
  border-radius:12px;
  border:1px solid var(--border);
  background:rgba(13,22,51,.8);
  color:white;
  font-size:14px;
  transition:all .3s ease;
}

.notes-toolbar input:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 20px rgba(77,195,255,.3);
  animation:focusPulse 1.5s ease-in-out infinite;
}

@keyframes focusPulse{
  0%, 100%{
    box-shadow:0 0 20px rgba(77,195,255,.3);
  }
  50%{
    box-shadow:0 0 30px rgba(77,195,255,.6);
  }
}

.notes-toolbar button{
  padding:12px 20px;
  border-radius:999px;
  border:none;
  background:var(--accent);
  color:#06101f;
  font-size:14px;
  font-weight:600;
  cursor:pointer;
  transition:transform .15s ease, box-shadow .15s ease;
}

.notes-toolbar button:hover{
  transform:scale(1.08);
  box-shadow:0 0 18px rgba(77,195,255,.6);
}

.notes-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:16px;
  margin-bottom:20px;
}

.note{
  background:linear-gradient(180deg,#1a2760,#121c44);
  border-radius:12px;
  padding:16px;
  border:1px solid var(--border);
  position:relative;
  word-wrap:break-word;
  transition:all .3s ease;
}

.note:hover{
  transform:translateY(-4px);
  box-shadow:0 12px 40px rgba(77,195,255,.2);
  border-color:rgba(77,195,255,.4);
}

.note-title{
  font-weight:600;
  margin-bottom:10px;
  padding-right:90px;
  font-size:15px;
}

.note-content{
  font-size:14px;
  color:var(--muted);
  line-height:1.6;
}

.note-content h1, .note-content h2, .note-content h3{
  color:var(--accent);
  margin-top:12px;
  margin-bottom:8px;
}

.note-content code{
  background:rgba(0,0,0,.3);
  padding:2px 6px;
  border-radius:4px;
  font-family:monospace;
}

.note-content pre{
  background:rgba(0,0,0,.3);
  padding:12px;
  border-radius:8px;
  overflow-x:auto;
}

.note-content pre code{
  background:transparent;
  padding:0;
}

.note-content blockquote{
  border-left:3px solid var(--accent);
  padding-left:12px;
  margin-left:0;
  color:var(--muted);
}

.note-content a{
  color:var(--accent);
  text-decoration:none;
}

.note-content a:hover{
  text-decoration:underline;
}

.note-controls{
  position:absolute;
  top:12px;
  right:12px;
  display:flex;
  gap:8px;
  font-size:13px;
  align-items:center;
}

.note-controls span{
  cursor:pointer;
  color:var(--accent);
  padding:4px 8px;
  border-radius:6px;
  transition:background .15s ease;
}

.note-controls span:hover{
  background:rgba(77,195,255,.15);
}

.note-md-badge{
  font-size:10px;
  padding:3px 8px;
  background:rgba(127,95,255,.35);
  border-radius:999px;
  color:white;
  font-weight:600;
  cursor:default;
}

.note-md-badge.active{
  background:var(--highlight);
}

.status-bar-container{
  background:linear-gradient(180deg,#0b142b,#0e1833);
  border-top:1px solid var(--border);
  padding:12px 30px;
  display:flex;
  align-items:center;
  gap:12px;
  z-index:50;
}

.status-pill{
  padding:6px 14px;
  border-radius:999px;
  background:rgba(77,195,255,.12);
  border:1px solid rgba(77,195,255,.35);
  font-size:12px;
  transition:all .3s ease;
}

.status-pill:hover{
  background:rgba(77,195,255,.2);
  transform:scale(1.05);
}

#versionPage{
  display:none;
  padding:60px 30px;
  text-align:center;
}

#versionPage p{
  font-size:20px;
  margin-bottom:30px;
}

#versionPage .version-logo{
  width:200px;
  height:200px;
  margin:0 auto;
  background:linear-gradient(135deg,var(--accent),var(--highlight));
  border-radius:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:48px;
  font-weight:700;
  color:white;
  box-shadow:0 20px 60px rgba(77,195,255,.3);
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
  backdrop-filter:blur(4px);
}

.modal-content{
  background:linear-gradient(180deg,#111a33,#0e1730);
  border-radius:16px;
  border:1px solid var(--border);
  padding:28px;
  max-width:600px;
  width:90%;
  max-height:80vh;
  overflow-y:auto;
  box-shadow:0 30px 80px rgba(0,0,0,.8);
}

.modal-content h3{
  margin:0 0 20px 0;
  color:var(--accent);
  font-size:22px;
}

.modal-content input[type="text"],
.modal-content input[type="email"],
.modal-content input[type="password"]{
  width:100%;
  padding:12px 16px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0d1633;
  color:white;
  margin-bottom:14px;
  font-family:inherit;
  font-size:14px;
  transition:all .3s ease;
}

.modal-content input[type="text"]:focus,
.modal-content input[type="email"]:focus,
.modal-content input[type="password"]:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 20px rgba(77,195,255,.3);
  animation:focusPulse 1.5s ease-in-out infinite;
}

.modal-content input[type="text"].error{
  animation:errorFlash 0.5s ease-in-out 3;
  border-color:#ff4444;
}

@keyframes errorFlash{
  0%, 100%{
    border-color:#ff4444;
    box-shadow:0 0 20px rgba(255,68,68,.4);
  }
  50%{
    border-color:#ff0000;
    box-shadow:0 0 30px rgba(255,0,0,.7);
  }
}

.modal-content textarea{
  width:100%;
  padding:12px 16px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0d1633;
  color:white;
  margin-bottom:14px;
  font-family:inherit;
  min-height:200px;
  resize:vertical;
  font-size:14px;
  line-height:1.6;
  transition:all .3s ease;
}

.modal-content textarea:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 20px rgba(77,195,255,.3);
  animation:focusPulse 1.5s ease-in-out infinite;
}

.modal-content label{
  display:flex;
  align-items:center;
  gap:10px;
  margin:14px 0;
  color:var(--muted);
  font-size:14px;
  cursor:pointer;
}

.modal-content input[type="checkbox"]{
  cursor:pointer;
}

.modal-actions{
  display:flex;
  justify-content:flex-end;
  gap:12px;
  margin-top:24px;
}

.modal-actions button{
  padding:10px 24px;
  border-radius:999px;
  border:none;
  font-weight:600;
  cursor:pointer;
  transition:transform .15s ease, box-shadow .15s ease;
}

.modal-actions .cancelBtn{
  background:rgba(255,255,255,.1);
  color:white;
}

.modal-actions .saveBtn{
  background:var(--accent);
  color:#06101f;
}

.modal-actions button:hover{
  transform:scale(1.06);
}

.confirm-dialog{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
  backdrop-filter:blur(4px);
}

.confirm-dialog-content{
  background:linear-gradient(180deg,#111a33,#0e1730);
  border-radius:16px;
  border:1px solid var(--border);
  padding:28px;
  max-width:400px;
  width:90%;
  box-shadow:0 30px 80px rgba(0,0,0,.8);
}

.confirm-dialog-header{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:16px;
}

.confirm-dialog-icon{
  font-size:32px;
}

.confirm-dialog-title{
  font-size:20px;
  font-weight:700;
  color:var(--accent);
}

.confirm-dialog-message{
  color:var(--muted);
  line-height:1.6;
  margin-bottom:24px;
  font-size:15px;
}

.confirm-dialog-actions{
  display:flex;
  justify-content:flex-end;
  gap:12px;
}

.confirm-dialog-actions button{
  padding:10px 24px;
  border-radius:999px;
  border:none;
  font-weight:600;
  cursor:pointer;
  transition:transform .15s ease, box-shadow .15s ease;
}

.confirm-dialog-actions .confirm-cancel{
  background:rgba(255,255,255,.1);
  color:white;
}

.confirm-dialog-actions .confirm-yes{
  background:#ff4444;
  color:white;
}

.confirm-dialog-actions button:hover{
  transform:scale(1.06);
}

.tabs{
  display:flex;
  gap:8px;
  margin-bottom:14px;
  border-bottom:1px solid var(--border);
}

.tab{
  padding:10px 24px;
  background:transparent;
  border:none;
  color:var(--muted);
  cursor:pointer;
  font-weight:600;
  font-size:14px;
  border-bottom:2px solid transparent;
  transition:all .15s ease;
}

.tab:hover{
  color:var(--text);
}

.tab.active{
  color:var(--accent);
  border-bottom-color:var(--accent);
}

.tab-content{
  display:none;
}

.tab-content.active{
  display:block;
}

.preview-content{
  padding:14px;
  background:#0d1633;
  border-radius:10px;
  border:1px solid var(--border);
  min-height:200px;
  color:var(--text);
  line-height:1.6;
}

.preview-content h1, .preview-content h2, .preview-content h3{
  color:var(--accent);
  margin-top:14px;
  margin-bottom:10px;
}

.preview-content code{
  background:rgba(0,0,0,.3);
  padding:2px 6px;
  border-radius:4px;
  font-family:monospace;
}

.preview-content pre{
  background:rgba(0,0,0,.3);
  padding:12px;
  border-radius:8px;
  overflow-x:auto;
}

.preview-content pre code{
  background:transparent;
  padding:0;
}

.preview-content blockquote{
  border-left:3px solid var(--accent);
  padding-left:12px;
  margin-left:0;
  color:var(--muted);
}

.preview-content a{
  color:var(--accent);
  text-decoration:none;
}

.preview-content a:hover{
  text-decoration:underline;
}

.preview-content ul, .preview-content ol{
  padding-left:20px;
}

.highlight{
  background:rgba(127,95,255,.6);
  padding:2px 4px;
  border-radius:4px;
  animation:highlightPulse 2s ease-in-out infinite;
}

@keyframes highlightPulse{
  0%, 100%{
    background:rgba(127,95,255,.6);
    box-shadow:0 0 10px rgba(127,95,255,.3);
  }
  50%{
    background:rgba(127,95,255,.8);
    box-shadow:0 0 20px rgba(127,95,255,.5);
  }
}

.empty-state{
  text-align:center;
  padding:60px 20px;
  color:var(--muted);
}

.empty-state div:first-child{
  font-size:56px;
  margin-bottom:16px;
}

.empty-state div:last-child{
  font-size:16px;
}

/* Auth Section Styles */
#authSection{
  display:none;
}

.auth-panel{
  max-width:400px;
  margin:40px auto;
}

.auth-toggle{
  text-align:center;
  margin-top:16px;
  color:var(--muted);
  font-size:14px;
}

.auth-toggle button{
  background:none;
  border:none;
  color:var(--accent);
  cursor:pointer;
  text-decoration:underline;
  font-size:14px;
}

.auth-message{
  padding:12px;
  border-radius:8px;
  margin-bottom:14px;
  font-size:14px;
  text-align:center;
}

.auth-message.error{
  background:rgba(255,68,68,.2);
  border:1px solid rgba(255,68,68,.4);
  color:#ff4444;
}

.auth-message.success{
  background:rgba(77,195,255,.2);
  border:1px solid rgba(77,195,255,.4);
  color:var(--accent);
}

.user-info{
  display:flex;
  align-items:center;
  gap:12px;
  padding:8px 0;
}

.user-info button{
  padding:6px 16px;
  border-radius:999px;
  border:none;
  background:rgba(255,68,68,.2);
  color:#ff6666;
  font-size:12px;
  font-weight:600;
  cursor:pointer;
  transition:all .3s ease;
}

.user-info button:hover{
  background:rgba(255,68,68,.3);
  transform:scale(1.05);
}

/* ===== AUTH INPUTS (MATCH BLUE PULSING STYLE) ===== */
#authSection input[type="email"],
#authSection input[type="password"]{
  width:100%;
  padding:12px 16px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0d1633;
  color:white;
  margin-bottom:14px;
  font-family:inherit;
  font-size:14px;
  transition:all .3s ease;
}

#authSection input[type="email"]:focus,
#authSection input[type="password"]:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 20px rgba(77,195,255,.3);
  animation:focusPulse 1.5s ease-in-out infinite;
}
/* ===== AUTH BUTTONS (FLOAT + SHADOW LIKE OTHER BUTTONS) ===== */
.auth-btn{
  flex:1;
  padding:12px;
  border-radius:999px;
  border:none;
  font-weight:600;
  cursor:pointer;
  font-size:14px;
  transition:transform .15s ease, box-shadow .15s ease;
}

.auth-btn.primary{
  background:var(--accent);
  color:#06101f;
}

.auth-btn.secondary{
  background:rgba(77,195,255,.2);
  color:var(--accent);
}

.auth-btn:hover{
  transform:scale(1.08);
  box-shadow:0 0 18px rgba(77,195,255,.6);
}

</style>
</head>

<body>

<div class="app-container">
  <!-- Auth Section (shows when not logged in) -->
  <div id="authSection">
    <div class="workspace">
      <div class="auth-panel panel">
        <h2 style="text-align:center; margin-bottom:24px;">Welcome to Notra</h2>
        <div id="authMessage" class="auth-message" style="display:none;"></div>
        
        <input type="email" id="authEmail" placeholder="Email">
        <input type="password" id="authPassword" placeholder="Password">
        
        <div style="display:flex; gap:12px; margin-top:20px;">
          <button id="signInBtn" class="auth-btn primary">
             Sign In
          </button>

          <button id="signUpBtn" class="auth-btn secondary">
            Sign Up
          </button>

        </div>
        
        <div class="auth-toggle">
          <p>Your notes will sync automatically to the cloud and be available on any device.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main App (shows when logged in) -->
  <div class="main-layout" id="mainApp" style="display:none;">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>NOTRA</h1>
      </div>
      
      <div class="sidebar-content">
        <div class="sidebar-title">Quick Actions</div>
        <div class="sidebar-actions">
          <div class="sidebar-action" data-url="mailto:abdullahbinnuman511@gmail.com">
            <div class="sidebar-action-icon">‚úâÔ∏è</div>
            <div class="sidebar-action-content">
              <div class="sidebar-action-title">Contact Notra</div>
              <div class="sidebar-action-desc">Support or enquiries</div>
            </div>
          </div>
          
          <div class="sidebar-action" data-url="https://docs.google.com/document/d/1sKoZ2Dyv1tQ7Wfl8OCMlpBWfPtatzVgIIttIHWMMZxU/edit">
            <div class="sidebar-action-icon">üìÑ</div>
            <div class="sidebar-action-content">
              <div class="sidebar-action-title">Terms of Service</div>
              <div class="sidebar-action-desc">Policies & conditions</div>
            </div>
          </div>
          
          <div class="sidebar-action" id="softwareVersionBtn">
            <div class="sidebar-action-icon">‚ÑπÔ∏è</div>
            <div class="sidebar-action-content">
              <div class="sidebar-action-title">Software Version</div>
              <div class="sidebar-action-desc">View current version</div>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <div class="content-area">
      <div class="content-header">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h2>üìù My Notes</h2>
          <div class="user-info">
            <span id="userEmail" style="font-size:14px; color:var(--muted);"></span>
            <button id="logOutBtn">Log Out</button>
          </div>
        </div>
      </div>
      
      <div class="workspace" id="appContent">
        <button id="backButton">‚Üê Back</button>
        
        <div class="panel">
          <div class="notes-toolbar">
            <input id="searchNotes" placeholder="üîç Search notes...">
            <button id="addNote">+ Add Note</button>
            <button id="downloadNote">‚¨á Export</button>
          </div>
          <div class="notes-grid" id="notesGrid"></div>
        </div>

        <div id="versionPage">
          <p>Your software is running Notra - Version 4.2.1 (Cloud Sync)</p>
          <div class="version-logo">NOTRA</div>
        </div>
      </div>
    </div>
  </div>

  <div class="status-bar-container" id="statusBar" style="display:none;">
    <div class="status-pill" id="statusApp">üü¢ App Ready</div>
    <div class="status-pill" id="statusNet">üåê Online</div>
    <div class="status-pill" id="statusSync">‚òÅÔ∏è Synced</div>
  </div>
</div>

<div id="confirmDialog" class="confirm-dialog">
  <div class="confirm-dialog-content">
    <div class="confirm-dialog-header">
      <div class="confirm-dialog-icon">‚ö†Ô∏è</div>
      <div class="confirm-dialog-title">Notra</div>
    </div>
    <div class="confirm-dialog-message" id="confirmMessage">
      Are you sure you want to delete this note?
    </div>
    <div class="confirm-dialog-actions">
      <button class="confirm-cancel" id="confirmCancelBtn">Cancel</button>
      <button class="confirm-yes" id="confirmYesBtn">Yes</button>
    </div>
  </div>
</div>

<div id="noteModal" class="modal">
  <div class="modal-content">
    <h3 id="noteModalTitle">Add Note</h3>
    <input type="text" id="noteTitle" placeholder="Note title...">
    
    <label>
      <input type="checkbox" id="markdownCheckbox">
      Enable Markdown for this note
    </label>
    
    <div class="tabs" id="editorTabs" style="display:none;">
      <button class="tab active" data-tab="write">Write</button>
      <button class="tab" data-tab="preview">Preview</button>
    </div>
    
    <div class="tab-content active" id="writeTab">
      <textarea id="noteContent" placeholder="Note content..."></textarea>
    </div>
    
    <div class="tab-content" id="previewTab">
      <div class="preview-content" id="previewContent">
        <p style="color:var(--muted);">Nothing to preview yet...</p>
      </div>
    </div>
    
    <div class="modal-actions">
      <button class="cancelBtn" id="cancelNoteBtn">Cancel</button>
      <button class="saveBtn" id="saveNoteBtn">Save</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
import { getFirestore, collection, doc, setDoc, getDocs, deleteDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

// REPLACE WITH YOUR FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyC2mQSgu5pxNk74f7TWafAFzehBgGC2nI4",
  authDomain: "notra-98c76.firebaseapp.com",
  projectId: "notra-98c76",
  storageBucket: "notra-98c76.firebasestorage.app",
  messagingSenderId: "166720115809",
  appId: "1:166720115809:web:0049b8dfd7a1301ab5c620",
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let notes = [];
let currentEditIndex = -1;
let searchQuery = '';
let confirmCallback = null;

const authSection = document.getElementById('authSection');
const mainApp = document.getElementById('mainApp');
const statusBar = document.getElementById('statusBar');
const backButton = document.getElementById('backButton');
const appContent = document.getElementById('appContent');
const versionPage = document.getElementById('versionPage');
const grid = document.getElementById('notesGrid');
const searchInput = document.getElementById('searchNotes');
const noteContentTextarea = document.getElementById('noteContent');
const previewContent = document.getElementById('previewContent');
const editorTabs = document.getElementById('editorTabs');
const markdownCheckbox = document.getElementById('markdownCheckbox');

// Auth UI Elements
const authEmail = document.getElementById('authEmail');
const authPassword = document.getElementById('authPassword');
const signInBtn = document.getElementById('signInBtn');
const signUpBtn = document.getElementById('signUpBtn');
const authMessage = document.getElementById('authMessage');
const userEmail = document.getElementById('userEmail');
const logOutBtn = document.getElementById('logOutBtn');
const statusSync = document.getElementById('statusSync');

// Show auth message
function showAuthMessage(message, isError = false) {
  authMessage.textContent = message;
  authMessage.className = 'auth-message ' + (isError ? 'error' : 'success');
  authMessage.style.display = 'block';
  setTimeout(() => {
    authMessage.style.display = 'none';
  }, 5000);
}

// Sign Up
signUpBtn.onclick = async function() {
  const email = authEmail.value.trim();
  const password = authPassword.value.trim();
  
  if (!email || !password) {
    showAuthMessage('Please enter email and password', true);
    return;
  }
  
  if (password.length < 6) {
    showAuthMessage('Password must be at least 6 characters', true);
    return;
  }
  
  try {
    await createUserWithEmailAndPassword(auth, email, password);
    showAuthMessage('Account created successfully!');
  } catch (error) {
    console.error('Sign up error:', error);
    showAuthMessage(error.message, true);
  }
};

// Sign In
signInBtn.onclick = async function() {
  const email = authEmail.value.trim();
  const password = authPassword.value.trim();
  
  if (!email || !password) {
    showAuthMessage('Please enter email and password', true);
    return;
  }
  
  try {
    await signInWithEmailAndPassword(auth, email, password);
    showAuthMessage('Signed in successfully!');
  } catch (error) {
    console.error('Sign in error:', error);
    showAuthMessage(error.message, true);
  }
};

// Log Out
logOutBtn.onclick = async function() {
  try {
    await signOut(auth);
  } catch (error) {
    console.error('Sign out error:', error);
  }
};

// Listen to auth state changes
onAuthStateChanged(auth, async (user) => {
  if (user) {
    // User logged in
    authSection.style.display = 'none';
    mainApp.style.display = 'flex';
    statusBar.style.display = 'flex';
    userEmail.textContent = user.email;
    
    // Load notes
    await loadNotes();
  } else {
    // User logged out
    authSection.style.display = 'block';
    mainApp.style.display = 'none';
    statusBar.style.display = 'none';
    notes = [];
    renderNotes();
    
    // Clear auth inputs
    authEmail.value = '';
    authPassword.value = '';
  }
});

// Save note (local + cloud)
async function saveNote() {
  const titleInput = document.getElementById('noteTitle');
  const title = titleInput.value.trim();
  const content = noteContentTextarea.value.trim();
  const isMarkdown = markdownCheckbox.checked;
  
  if (!title) {
    titleInput.classList.add('error');
    setTimeout(function() {
      titleInput.classList.remove('error');
      titleInput.focus();
    }, 1500);
    return;
  }
  
  const noteData = {
    title: title,
    content: content,
    isMarkdown: isMarkdown,
    updatedAt: Date.now()
  };
  
  // Update local array
  if (currentEditIndex === -1) {
    noteData.id = Date.now().toString();
    notes.push(noteData);
  } else {
    noteData.id = notes[currentEditIndex].id;
    notes[currentEditIndex] = noteData;
  }
  
  // Save to localStorage
  localStorage.setItem(`note_${noteData.id}`, JSON.stringify(noteData));
  
  // Save to Firebase
  if (auth.currentUser) {
    try {
      statusSync.textContent = '‚è≥ Syncing...';
      await setDoc(
        doc(db, 'users', auth.currentUser.uid, 'notes', noteData.id),
        noteData
      );
      statusSync.textContent = '‚òÅÔ∏è Synced';
      console.log('Note synced to cloud');
    } catch (error) {
      console.error('Cloud sync failed:', error);
      statusSync.textContent = '‚ö†Ô∏è Sync Failed';
    }
  }
  
  closeNoteModal();
  renderNotes();
}

// Load all notes
async function loadNotes() {
  // 1. Load from localStorage first
  const localNotes = [];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith('note_')) {
      try {
        const note = JSON.parse(localStorage.getItem(key));
        localNotes.push(note);
      } catch (e) {
        console.error('Error parsing note:', e);
      }
    }
  }
  
  notes = localNotes;
  renderNotes();
  
  // 2. Sync with cloud if logged in
  if (auth.currentUser) {
    try {
      statusSync.textContent = '‚è≥ Syncing...';
      const notesRef = collection(db, 'users', auth.currentUser.uid, 'notes');
      const q = query(notesRef, orderBy('updatedAt', 'desc'));
      const snapshot = await getDocs(q);
      
      const cloudNotes = [];
      snapshot.forEach(doc => {
        cloudNotes.push(doc.data());
      });
      
      // Merge: use cloud version if it's newer
      const merged = mergeNotes(localNotes, cloudNotes);
      
      // Update localStorage with cloud data
      merged.forEach(note => {
        localStorage.setItem(`note_${note.id}`, JSON.stringify(note));
      });
      
      notes = merged;
      renderNotes();
      statusSync.textContent = '‚òÅÔ∏è Synced';
      console.log('Notes synced from cloud');
    } catch (error) {
      console.error('Cloud load failed:', error);
      statusSync.textContent = '‚ö†Ô∏è Sync Failed';
    }
  }
}

// Merge local and cloud notes
function mergeNotes(localNotes, cloudNotes) {
  const notesMap = new Map();
  
  // Add local notes
  localNotes.forEach(note => {
    notesMap.set(note.id, note);
  });
  
  // Override with cloud notes if they're newer
  cloudNotes.forEach(note => {
    const existing = notesMap.get(note.id);
    if (!existing || note.updatedAt > existing.updatedAt) {
      notesMap.set(note.id, note);
    }
  });
  
  return Array.from(notesMap.values());
}

// Delete note
async function handleDelete(index) {
  showConfirmDialog('Are you sure you want to delete this note?', async function() {
    const noteId = notes[index].id;
    
    // Remove from array
    notes.splice(index, 1);
    
    // Delete from localStorage
    localStorage.removeItem(`note_${noteId}`);
    
    // Delete from Firebase
    if (auth.currentUser) {
      try {
        statusSync.textContent = '‚è≥ Syncing...';
        await deleteDoc(doc(db, 'users', auth.currentUser.uid, 'notes', noteId));
        statusSync.textContent = '‚òÅÔ∏è Synced';
        console.log('Note deleted from cloud');
      } catch (error) {
        console.error('Cloud delete failed:', error);
        statusSync.textContent = '‚ö†Ô∏è Sync Failed';
      }
    }
    
    renderNotes();
  });
}

function showConfirmDialog(message, callback) {
  document.getElementById('confirmMessage').textContent = message;
  document.getElementById('confirmDialog').style.display = 'flex';
  confirmCallback = callback;
}

function closeConfirmDialog() {
  document.getElementById('confirmDialog').style.display = 'none';
  confirmCallback = null;
}

function confirmDialogYes() {
  if (confirmCallback) {
    confirmCallback();
  }
  closeConfirmDialog();
}

document.getElementById('confirmCancelBtn').onclick = closeConfirmDialog;
document.getElementById('confirmYesBtn').onclick = confirmDialogYes;

document.getElementById('softwareVersionBtn').onclick = function() {
  appContent.querySelector('.panel').style.display = 'none';
  versionPage.style.display = 'block';
  backButton.style.display = 'inline-block';
};

backButton.onclick = function() {
  appContent.querySelector('.panel').style.display = '';
  versionPage.style.display = 'none';
  backButton.style.display = 'none';
};

document.querySelectorAll('.sidebar-action[data-url]').forEach(function(action) {
  action.onclick = function() {
    const url = action.getAttribute('data-url');
    if (url) window.open(url, '_blank');
  };
});

const statusNet = document.getElementById('statusNet');
statusNet.textContent = navigator.onLine ? 'üåê Online' : 'üî¥ Offline';
window.addEventListener('online', function() {
  statusNet.textContent = 'üåê Online';
});
window.addEventListener('offline', function() {
  statusNet.textContent = 'üî¥ Offline';
});

markdownCheckbox.addEventListener('change', function() {
  if (markdownCheckbox.checked) {
    editorTabs.style.display = 'flex';
  } else {
    editorTabs.style.display = 'none';
    document.querySelectorAll('.tab').forEach(function(t) {
      t.classList.remove('active');
    });
    document.querySelector('.tab[data-tab="write"]').classList.add('active');
    document.querySelectorAll('.tab-content').forEach(function(content) {
      content.classList.remove('active');
    });
    document.getElementById('writeTab').classList.add('active');
  }
});

document.querySelectorAll('.tab').forEach(function(tab) {
  tab.addEventListener('click', function() {
    const tabName = tab.getAttribute('data-tab');
    
    document.querySelectorAll('.tab').forEach(function(t) {
      t.classList.remove('active');
    });
    tab.classList.add('active');
    
    document.querySelectorAll('.tab-content').forEach(function(content) {
      content.classList.remove('active');
    });
    
    if (tabName === 'write') {
      document.getElementById('writeTab').classList.add('active');
    } else if (tabName === 'preview') {
      document.getElementById('previewTab').classList.add('active');
      updatePreview();
    }
  });
});

function updatePreview() {
  const content = noteContentTextarea.value.trim();
  if (!content) {
    previewContent.innerHTML = '<p style="color:var(--muted);">Nothing to preview yet...</p>';
    return;
  }
  
  if (markdownCheckbox.checked && typeof marked !== 'undefined') {
    previewContent.innerHTML = marked.parse(content);
  } else {
    previewContent.textContent = content;
  }
}

noteContentTextarea.addEventListener('input', function() {
  if (markdownCheckbox.checked && document.querySelector('.tab[data-tab="preview"]').classList.contains('active')) {
    updatePreview();
  }
});

function renderNotes() {
  grid.innerHTML = '';
  
  let filteredNotes = notes;
  
  if (searchQuery) {
    filteredNotes = notes.filter(function(n) {
      const searchText = (n.title + ' ' + n.content).toLowerCase();
      return searchText.includes(searchQuery.toLowerCase());
    });
  }
  
  if (filteredNotes.length === 0) {
    grid.innerHTML = '<div class="empty-state" style="grid-column:1/-1"><div>üìù</div><div>' + (searchQuery ? 'No notes found' : 'No notes yet. Click "+ Add Note" to create one!') + '</div></div>';
    return;
  }
  
  filteredNotes.forEach(function(n) {
    const actualIndex = notes.indexOf(n);
    const div = document.createElement('div');
    div.className = 'note';
    
    let titleHTML = escapeHtml(n.title);
    let contentHTML = n.content;
    
    if (n.isMarkdown && typeof marked !== 'undefined') {
      contentHTML = marked.parse(n.content);
    } else {
      contentHTML = escapeHtml(n.content);
    }
    
    if (searchQuery) {
      const regex = new RegExp('(' + escapeRegex(searchQuery) + ')', 'gi');
      titleHTML = titleHTML.replace(regex, '<span class="highlight">$1</span>');
      
      if (!n.isMarkdown) {
        contentHTML = contentHTML.replace(regex, '<span class="highlight">$1</span>');
      }
    }
    
    const mdBadge = n.isMarkdown ? '<span class="note-md-badge active">MD</span>' : '';
    
    div.innerHTML = '<div class="note-controls">' + mdBadge + '<span onclick="handleEdit(' + actualIndex + ')" title="Edit">‚úèÔ∏è</span><span onclick="handleDelete(' + actualIndex + ')" title="Delete">üóëÔ∏è</span></div><div class="note-title">' + titleHTML + '</div><div class="note-content">' + contentHTML + '</div>';
    
    grid.appendChild(div);
  });
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function escapeRegex(str) {
  return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

searchInput.oninput = function(e) {
  searchQuery = e.target.value;
  renderNotes();
};

document.getElementById('addNote').onclick = function() {
  currentEditIndex = -1;
  document.getElementById('noteModalTitle').textContent = 'Add Note';
  document.getElementById('noteTitle').value = '';
  noteContentTextarea.value = '';
  markdownCheckbox.checked = false;
  editorTabs.style.display = 'none';
  
  document.querySelectorAll('.tab').forEach(function(t) {
    t.classList.remove('active');
  });
  document.querySelector('.tab[data-tab="write"]').classList.add('active');
  document.querySelectorAll('.tab-content').forEach(function(content) {
    content.classList.remove('active');
  });
  document.getElementById('writeTab').classList.add('active');
  
  document.getElementById('noteModal').style.display = 'flex';
  
  setTimeout(function() {
    document.getElementById('noteTitle').focus();
  }, 100);
};

function closeNoteModal() {
  document.getElementById('noteModal').style.display = 'none';
  document.getElementById('noteTitle').value = '';
  noteContentTextarea.value = '';
  markdownCheckbox.checked = false;
  currentEditIndex = -1;
  document.getElementById('noteTitle').classList.remove('error');
}

function handleEdit(index) {
  currentEditIndex = index;
  document.getElementById('noteModalTitle').textContent = 'Edit Note';
  document.getElementById('noteTitle').value = notes[index].title;
  noteContentTextarea.value = notes[index].content;
  markdownCheckbox.checked = notes[index].isMarkdown || false;
  
  if (markdownCheckbox.checked) {
    editorTabs.style.display = 'flex';
  } else {
    editorTabs.style.display = 'none';
  }
  
  document.querySelectorAll('.tab').forEach(function(t) {
    t.classList.remove('active');
  });
  document.querySelector('.tab[data-tab="write"]').classList.add('active');
  document.querySelectorAll('.tab-content').forEach(function(content) {
    content.classList.remove('active');
  });
  document.getElementById('writeTab').classList.add('active');
  
  document.getElementById('noteModal').style.display = 'flex';
  
  setTimeout(function() {
    document.getElementById('noteTitle').focus();
  }, 100);
}

window.handleEdit = handleEdit;
window.handleDelete = handleDelete;

document.getElementById('cancelNoteBtn').onclick = closeNoteModal;
document.getElementById('saveNoteBtn').onclick = saveNote;

document.getElementById('downloadNote').onclick = function() {
  if (notes.length === 0) {
    showConfirmDialog('No notes to export', function() {});
    return;
  }
  
  let content = 'NOTRA - NOTES EXPORT\n';
  content += '================================\n\n';
  
  notes.forEach(function(n, i) {
    content += (i + 1) + '. ' + n.title;
    if (n.isMarkdown) content += ' [Markdown]';
    content += '\n';
    content += '-'.repeat(n.title.length + 3) + '\n';
    
    if (n.isMarkdown && typeof marked !== 'undefined') {
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = marked.parse(n.content);
      content += tempDiv.textContent + '\n\n';
    } else {
      content += n.content + '\n\n';
    }
  });
  
  const blob = new Blob([content], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'notra-notes-' + new Date().toISOString().split('T')[0] + '.txt';
  a.click();
  URL.revokeObjectURL(url);
};

console.log('‚ú® Notra app initialized with Firebase!');
console.log('üíæ Storage: localStorage + Firebase Cloud Sync');
</script>

</body>
</html>

